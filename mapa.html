<html>
	<head>
 		<link rel="stylesheet" href="leaflet/leaflet.css" />
		<script src="leaflet/leaflet.js" ></script>
		<script src="https://d3js.org/d3.v5.min.js"></script>
	<style>
  		#map { height: 600px; }
	</style>
	</head>
	<body>
		<div id="map"></div>

		<script>
			var map = L.map('map').setView([40.4165, -3.70256], 13);

			var tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
				maxZoom: 18,
				attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
					'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
				id: 'mapbox/streets-v11',
				tileSize: 512,
				zoomOffset: -1
			}).addTo(map);


			var marker=L.marker([40.423852,-3.712246]).addTo(map);
			marker.bindPopup("<b>Plaza de España</b>");

			var stations = [];

			function renderStations() {
					// remove old markers
				stations.forEach(function(s) {
					s.remove();
				})
			
				stations = [];

				var dataOneDate;
				d3.csv("./data/clima.csv", function(data) {
					filteredData = data.filter(function(row) {
						return row['DIA'] = 'D01';
					});
					dataOneDate = filteredData.map(function(d) {
						return {
							Estacion: d.ESTACION,
							S02: d.S02
						}
					});
				});

				console.log(dataOneDate);

				//const data = await d3.csv("./data/clima.csv");

				data.features.forEach(function(feature) {
					var c = L.circleMarker(
						[feature.geometry.coordinates[1], feature.geometry.coordinates[0]], {
							radius: radiusScale(feature.properties[currProperty]),
							// color: colorScale(feature.properties[currProperty]),
							color: 'black',
							fillColor: colorScale(feature.properties[currProperty]),
							fillOpacity: 0.5
					});
					c.addTo(theMap);
					c.bindTooltip('<h3>' + feature.properties.name + '</h3>' + '<b>' + currProperty + ': </b>' + numberFormatter(feature.properties[currProperty]) + '<br>' + properties.filter(d => d.code === currProperty)[0].desc);
					circles.push(c);
				});
			}

			function fetchData(dateStr) {
				var url = 'https://xyz.api.here.com/hub/spaces/' + spaceID + '/search?limit=100&access_token=' + accessToken + '&tags=' + dateStr;
				d3.json(url).then(function(data) {
					theData = data;
					renderCircles();
				});
			}

			//fetchData(initDate);
			renderStations();

		</script>
	</body>
</html>
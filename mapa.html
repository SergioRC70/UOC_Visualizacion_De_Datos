<html>
	<head>
		<meta charset="UTF-8">

		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<link rel="stylesheet" href="mapstyle.css">
 		
 		<link rel="stylesheet" href="leaflet/leaflet.css" />
		<script src="leaflet/leaflet.js" ></script>

		<script src="d3_color-legend.js" ></script>
		<script src="renderStations.js" ></script>
		<script src="https://d3js.org/d3.v5.min.js"></script>

		<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
		<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
		<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400,700&display=swap" rel="stylesheet">

		<script>
			// Añadimos el datepicker a la capa de selección de día
			$( function() {
				$( "#datepicker" ).datepicker({ dateFormat: 'dd-mm-yy' });
			} );

			$('#datepicker').on('click', function(e) {
				e.preventDefault();
				$(this).attr("autocomplete", "off");  
			});


			$(function () {
				$("#dialog").dialog({
					modal: true,
					autoOpen: false,
					title: "Datos históricos de calidad del aire en Madrid",
					width: 600,
					height: 550
				});
				$("#info_icon").click(function () {
					$('#dialog').dialog('open');
				});
			});



		</script>
	</head>
	<body>
		<img id="info_icon" class="info_icon" src="img/info_icon.png" alt="Información de la visualización" />

		<div id="dialog" style="display: none">
			Esta visualización muestra los datos de calidad del aire recogidos en las estaciones de control de la ciudad de Madrid desde el año 2001 hasta el 31 de diciembre de 2021.<br/><br/>
			Los datos que se muestran has sido obtenidos del portal de datos abiertos del Ayuntamiento de Madrid. En concreto, la visualización muestra información de los siguiente juegos de datos:<br/>
			<ol>
				<li>
					<a href="https://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextoid=aecb88a7e2b73410VgnVCM2000000c205a0aRCRD&vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&vgnextfmt=default">Calidad del aire. Datos diarios</a>. Este conjunto de datos nos da la información de los valores de calidad del aire obtenidos por las 24 estaciones remotas automáticas que recogen la información básica para la vigilancia atmosférica. Los valores diarios se obtienen como una media aritmética de los 24 valores horarios de cada día.<br/><br/>
				</li>
				<li>
					<a href="https://datos.madrid.es/portal/site/egob/menuitem.c05c1f754a33a9fbe4b2e4b284f1a5a0/?vgnextoid=8d7357cec5efa610VgnVCM1000001d4a900aRCRD&vgnextchannel=374512b9ace9f310VgnVCM100000171f5a0aRCRD&vgnextfmt=default">Datos meteorológicos. Datos diarios</a>. Este conjunto de datos nos da la información de las estaciones de control pertenecientes a la red meteorológica municipal. 
				</li>
			</ol>
		</div>

		<div id="map"></div>

		<div id="overlay">
			<b>Seleccionar fecha de visualización de los datos.</b><br/><br/>
			Datos disponibles desde 01 de enero de 2001 hasta el 31 de diciembre de 2021<br/><br/>
			<b>Fecha:</b>&nbsp;&nbsp;&nbsp;<input type="text" id="datepicker" class="date">
		</div>

		<div id="meteo">
		</div>

		<script>
			// Creamos una variable donde vamos a almacenar los markers que añadios al mapa.
			// Los necesitaremos para borrarlos cuando cambie la selección.
			var circles = [];

			// Cremos el mapa de leaflet con las coordenadas de Madrid.
			var map = L.map('map').setView([40.4265, -3.67256], 13)

			// Creamos la capa y la añadimos nuestro mapa.
			var tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
				maxZoom: 18,
				attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
					'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
				id: 'mapbox/streets-v11',
				tileSize: 512,
				zoomOffset: -1,
			}).addTo(map);

			// Creamos el evento para el datepicker. Cuando cambie la selección llamamos a la función
			// renderStations (en el fichero renderStations.js) para dibujar todos los datos
			// correspondientes a ese día.
			$(".date").datepicker({
				onSelect: function(dateText, inst) {
					$(this).change();
					renderStations(new Date(inst.selectedYear, inst.selectedMonth, inst.selectedDay));
				}
			})
			.on("change", function() {
			});
		</script>

	</body>
</html>
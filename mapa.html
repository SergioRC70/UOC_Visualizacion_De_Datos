<html>
	<head>
		<meta charset="UTF-8">

		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<link rel="stylesheet" href="mapstyle.css">
 		
 		<link rel="stylesheet" href="leaflet/leaflet.css" />
		<script src="leaflet/leaflet.js" ></script>

		<script src="d3_color-legend.js" ></script>
		<script src="renderStations.js" ></script>
		<script src="https://d3js.org/d3.v5.min.js"></script>

		<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
		<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
		<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400,700&display=swap" rel="stylesheet">

		<script>
			// Añadimos el datepicker a la capa de selección de día
			$( function() {
				$( "#datepicker" ).datepicker({ dateFormat: 'dd-mm-yy' });
			} );

			$('#datepicker').on('click', function(e) {
				e.preventDefault();
				$(this).attr("autocomplete", "off");  
			});
		</script>
	</head>
	<body>
		<div id="map"></div>

		<div id="overlay">
			<b>Seleccionar fecha de visualización de los datos.</b><br/><br/>
			Datos disponibles desde 01 de enero de 2001 hasta el 31 de diciembre de 2021<br/><br/>
			Fecha:&nbsp;&nbsp;&nbsp;<input type="text" id="datepicker" class="date">
		</div>

		<div id="meteo">
		</div>

		<script>
			// Creamos una variable donde vamos a almacenar los markers que añadios al mapa.
			// Los necesitaremos para borrarlos cuando cambie la selección.
			var circles = [];

			// Cremos el mapa de leaflet con las coordenadas de Madrid.
			var map = L.map('map').setView([40.4265, -3.67256], 13)

			// Creamos la capa y la añadimos nuestro mapa.
			var tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
				maxZoom: 18,
				attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
					'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
				id: 'mapbox/streets-v11',
				tileSize: 512,
				zoomOffset: -1,
			}).addTo(map);

			// Creamos el evento para el datepicker. Cuando cambie la selección llamamos a la función
			// renderStations (en el fichero renderStations.js) para dibujar todos los datos
			// correspondientes a ese día.
			$(".date").datepicker({
				onSelect: function(dateText, inst) {
					$(this).change();
					renderStations(new Date(inst.selectedYear, inst.selectedMonth, inst.selectedDay));
				}
			})
			.on("change", function() {
			});
		</script>

	</body>
</html>